import{ag as a,s as e,x as l,h as t,r as s,g as o,a as c,k as i,e as u,w as n,b as r,F as d,i as v,d as p,l as f,f as m,t as b,y as _,j as k,a6 as w,S as y,ad as h}from"./index-BGdZDLVO.js";import{c as g,_ as j,b as x}from"./subject.D8rmnr1Z.js";import{_ as C,b as I,r as N}from"./request.RFVXOHA2.js";import{_ as $,a as z}from"./zero-markdown-view.DmmhTn2E.js";import{_ as A}from"./uni-icons.aWtZdbs2.js";import{_ as V}from"./uv-empty.C1WgQU4D.js";import{b as M,c as S,d as F,e as P}from"./topic.CgYxHBZP.js";import{a as U}from"./feedback.C3RPsMgp.js";import{F as q}from"./feedbackPopup.IabBU8gT.js";import"./uv-icon.DXxGSX6z.js";import"./uni-popup.BYn65RNm.js";const J=C({__name:"topic",setup(C){I((async s=>{console.log(s.name),console.log(s.id),console.log(s.subjectId),D.value=s.id,E.value=s.subjectId,a({title:s.name}),e({title:"加载中...",mask:!0});try{await Promise.all([K(s.subjectId),Q(s.id),O()])}catch(o){console.error("加载失败:",o),l({title:"加载失败，请重试",icon:"none"})}finally{t()}}));const J=s(JSON.parse(o("h5UserInfo"))),O=async()=>{await M({topicId:D.value,subjectId:E.value,nickname:J.value.nickname,avatar:J.value.avatar})},R=s({}),B=s(null),D=s(null),E=s(null),G=s(0),H=s(0),K=async a=>{const e=await g(a);e.data&&e.data.topicNameVos&&(R.value=e.data.topicNameVos,G.value=e.data.topicNameVos.length,B.value=e.data.topicNameVos.findIndex((a=>a.id==D.value)),B.value=B.value+1,H.value=Math.floor(B.value/G.value*100))},L=s({}),Q=async a=>{const e=await S(a);L.value=e.data,sa.value=e.data.isCollected},T=s(!0),W=s(!1),X=s({answer:null,aiAnswer:null}),Y=s(o("role")),Z=async()=>{if(console.log("查看答案"),1===L.value.isMember&&0==Y.value)return void l({title:"该题目答案需要会员才能查看哦",icon:"error",duration:2e3});const a=await F(D.value);X.value=a.data,aa.value=T.value?a.data.answer:a.data.aiAnswer,W.value=!0},aa=s(),ea=()=>{T.value=!T.value,T.value?aa.value=X.value.answer:aa.value=X.value.aiAnswer},la=s(!1),ta=async a=>{await U({feedbackContent:"题目"+D.value+":"+a,status:3}),l({title:"反馈成功可在我的反馈中查看",icon:"none",duration:2e3})},sa=s(!1),oa=async()=>{try{200===(await P(D.value)).code&&(sa.value=!sa.value,l({title:sa.value?"收藏成功":"取消收藏",icon:"success"}))}catch(a){l({title:"操作失败，请重试",icon:"none"})}},ca=s(),ia=async()=>{B.value<=1?l({title:"已经是第一题了",icon:"none"}):w({url:`/pages/database/topic/topic?id=${R.value[B.value-2].id}&name=${R.value[B.value-2].topicName}&subjectId=${E.value}`})},ua=()=>{B.value>=R.value.length?l({title:"已经是最后一题了",icon:"none"}):w({url:`/pages/database/topic/topic?id=${R.value[B.value].id}&name=${R.value[B.value].topicName}&subjectId=${E.value}`})};return(a,e)=>{const l=N(c("uni-list-item"),j),t=N(c("uni-list"),x),s=y,o=N(c("uni-drawer"),$),g=v,C=N(c("uni-icons"),A),I=N(c("zero-markdown-view"),z),M=N(c("uv-empty"),V),S=h;return p(),i(d,null,[u(o,{ref_key:"showRight",ref:ca,mode:"right",width:"260"},{default:n((()=>[u(s,{class:"scroll-view-box","scroll-y":"true",style:{height:"100vh"}},{default:n((()=>[u(t,null,{default:n((()=>[(p(!0),i(d,null,f(R.value,(a=>(p(),r(l,{class:_(["list-item",{active:a.id==D.value}]),showArrow:"",clickable:"",onClick:e=>(a=>{w({url:`/pages/database/topic/topic?id=${a.id}&name=${a.topicName}&subjectId=${E.value}`})})(a)},{header:n((()=>[m("span",{class:"title"},b(a.topicName),1)])),_:2},1032,["class","onClick"])))),256))])),_:1})])),_:1})])),_:1},512),u(q,{show:la.value,"onUpdate:show":e[0]||(e[0]=a=>la.value=a),onSubmit:ta},null,8,["show"]),L.value?(p(),r(g,{key:0,class:"topic"},{default:n((()=>[u(g,{class:"topic-box"},{default:n((()=>[u(g,{class:"topic-top"},{default:n((()=>[u(g,{class:"top-box"},{default:n((()=>[m("h2",{class:"topic-title"},b(L.value.topicName),1)])),_:1}),u(g,{class:"top-center"},{default:n((()=>[u(g,{class:"tags-row"},{default:n((()=>[(p(!0),i(d,null,f(L.value.labelNames,((a,e)=>(p(),r(g,{class:"tag",key:e},{default:n((()=>[k(b(a),1)])),_:2},1024)))),128))])),_:1}),u(g,{class:"star-box",onClick:oa},{default:n((()=>[u(C,{type:sa.value?"star-filled":"star",color:"#1677ff",size:"24"},null,8,["type"])])),_:1})])),_:1})])),_:1}),u(g,{class:"topic-divider"}),u(g,{class:"topic-bottom"},{default:n((()=>[u(g,{class:"tab-box"},{default:n((()=>[u(g,{class:_({"tab-one":!0,"active-tab-box":T.value}),onClick:ea},{default:n((()=>[k(" 精简答案 ")])),_:1},8,["class"]),u(g,{class:_({"tab-one":!0,"active-tab-box":!T.value}),onClick:ea},{default:n((()=>[k(" AI答案 ")])),_:1},8,["class"])])),_:1}),u(g,{class:"topic-answer"},{default:n((()=>[W.value?(p(),r(g,{key:1,class:"answer-box"},{default:n((()=>[aa.value?(p(),r(I,{key:0,markdown:aa.value},null,8,["markdown"])):(p(),r(M,{key:1,text:"系统正在完善题目答案哦～",icon:"../../../static/images/empty.png"}))])),_:1})):(p(),r(g,{key:0},{default:n((()=>[0===L.value.isMember?(p(),r(g,{key:0,class:"show-btn",onClick:Z},{default:n((()=>[k(" 点击查看答案 ")])),_:1})):(p(),r(g,{key:1,class:"show-btn vip-btn",onClick:Z},{default:n((()=>[k(" 开通会员查看答案 ")])),_:1}))])),_:1}))])),_:1})])),_:1}),u(g,{class:"topic-operation"},{default:n((()=>[u(g,{class:"operation-top"},{default:n((()=>[u(g,{class:"list-box",onClick:e[1]||(e[1]=a=>ca.value.open())},{default:n((()=>[u(C,{type:"list",color:"#1677ff",size:"20"}),m("span",{class:"topic"},b(L.value.topicName),1),k(" ("),m("span",{class:"topic-weight"},b(B.value),1),k("/"+b(G.value)+") ",1)])),_:1}),u(S,{class:"progress",percent:H.value,activeColor:"#1677ff","stroke-width":"6"},null,8,["percent"])])),_:1}),u(g,{class:"operation-bottom"},{default:n((()=>[u(g,{class:"game-controls"},{default:n((()=>[u(g,{class:"control-btn prev",onClick:ia},{default:n((()=>[u(g,{class:"btn-circle"},{default:n((()=>[u(C,{type:"left",size:"20",color:"#999"})])),_:1})])),_:1}),u(g,{class:"control-btn feedback"},{default:n((()=>[u(g,{class:"btn-circle",onClick:e[2]||(e[2]=a=>la.value=!0)},{default:n((()=>[u(C,{type:"info",size:"20",color:"#fff"})])),_:1})])),_:1}),u(g,{class:"control-btn next",onClick:ua},{default:n((()=>[u(g,{class:"btn-circle"},{default:n((()=>[u(C,{type:"right",size:"20",color:"#fff"})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(p(),r(M,{key:1,text:"系统正在完善题目信息哦～",icon:"../../../static/images/empty.png"}))],64)}}},[["__scopeId","data-v-7bb41833"]]);export{J as default};
